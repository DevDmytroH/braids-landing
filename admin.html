<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ - –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ü—Ä–æ–¥—É–∫—Ç–∞–º–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            color: #667eea;
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .label-hint {
            font-weight: 400;
            color: #999;
            font-size: 12px;
            margin-left: 5px;
        }

        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .translation-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .translation-header {
            font-weight: 700;
            color: #667eea;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .specs-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .spec-input-group {
            display: flex;
            gap: 10px;
        }

        .spec-input-group input {
            flex: 1;
        }

        .btn-remove-spec {
            padding: 12px 20px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-add-spec {
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
            margin-top: 20px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .products-list {
            margin-top: 30px;
        }

        .product-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .product-info {
            flex: 1;
        }

        .product-name {
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .product-price {
            color: #667eea;
            font-size: 18px;
            font-weight: 600;
        }

        .product-actions {
            display: flex;
            gap: 10px;
        }

        .btn-edit {
            padding: 8px 20px;
            background: #ffc107;
            color: #333;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        .btn-delete {
            padding: 8px 20px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .toast.error {
            background: #dc3545;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .emoji-input {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .emoji-input input {
            width: 70px;
            text-align: center;
            font-size: 24px;
        }

        .media-list {
            margin-top: 10px;
        }

        .media-item {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 2px solid #e0e0e0;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .instructions {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }

        .instructions strong {
            color: #856404;
        }

        .file-upload-section {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px dashed #667eea;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì¶ –ü–∞–Ω–µ–ª—å –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
        <p class="subtitle">–õ–µ–≥–∫–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ –Ω–∞ –≤–∞—à–æ–º—É —Å–∞–π—Ç—ñ</p>

        <!-- Existing Products -->
        <div class="section">
            <h2 class="section-title">üìã –Ü—Å–Ω—É—é—á—ñ –ü—Ä–æ–¥—É–∫—Ç–∏</h2>
            <div id="productsList" class="products-list">
                <p style="color: #999;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤...</p>
            </div>
        </div>

        <!-- Add/Edit Product Form -->
        <div class="section">
            <h2 class="section-title" id="formTitle">‚ûï –î–æ–¥–∞—Ç–∏ –ù–æ–≤–∏–π –ü—Ä–æ–¥—É–∫—Ç</h2>

            <div class="instructions">
                <strong>üìù –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è:</strong> –ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è –Ω–∏–∂—á–µ. –ß–µ—Ä–≤–æ–Ω—ñ –ø–æ–ª—è –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –¥–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è.
            </div>

            <form id="productForm">
                <!-- Basic Info -->
                <div class="form-row">
                    <div class="form-group">
                        <label>üÜî ID –ø—Ä–æ–¥—É–∫—Ç—É <span class="label-hint">(–∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é, –±–µ–∑ –ø—Ä–æ–±—ñ–ª—ñ–≤)</span></label>
                        <input type="text" id="productId" placeholder="boxBraidsLong" required>
                    </div>

                    <div class="form-group">
                        <label>üí∞ –¶—ñ–Ω–∞ (‚Ç¨)</label>
                        <input type="number" id="productPrice" placeholder="279" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>üè∑Ô∏è –ü–æ–∑–Ω–∞—á–∫–∞</label>
                        <select id="productBadge">
                            <option value="bestSeller">–ë–µ—Å—Ç—Å–µ–ª–µ—Ä</option>
                            <option value="premium">–ü—Ä–µ–º—ñ—É–º</option>
                            <option value="new">–ù–æ–≤–∏–Ω–∫–∞</option>
                            <option value="trending">–¢—Ä–µ–Ω–¥</option>
                            <option value="featured">–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ</option>
                            <option value="luxury">–õ—é–∫—Å</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>üòä –ï–º–æ–¥–∑—ñ (4 —à—Ç—É–∫–∏)</label>
                        <div class="emoji-input">
                            <input type="text" id="emoji1" placeholder="üå∫" maxlength="2" required>
                            <input type="text" id="emoji2" placeholder="üé®" maxlength="2" required>
                            <input type="text" id="emoji3" placeholder="‚ú®" maxlength="2" required>
                            <input type="text" id="emoji4" placeholder="üí´" maxlength="2" required>
                        </div>
                    </div>
                </div>

                <!-- Media Section -->
                <div class="form-group">
                    <label>üì∏ –ú–µ–¥—ñ–∞ (–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–∞ –í—ñ–¥–µ–æ)</label>
                    <div class="instructions" style="margin-bottom: 15px;">
                        <strong>–§–æ—Ä–º–∞—Ç:</strong> –í–∫–∞–∂—ñ—Ç—å –∫–æ–∂–µ–Ω –º–µ–¥—ñ–∞-—Ñ–∞–π–ª –æ–∫—Ä–µ–º–æ —á–µ—Ä–µ–∑ –∫–æ–º—É.<br>
                        <strong>–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è:</strong> 01.jpg, 02.webp, 03.png<br>
                        <strong>–í—ñ–¥–µ–æ:</strong> video:04.mp4<br>
                        <strong>–ü—Ä–∏–∫–ª–∞–¥:</strong> 01.jpg, 02.webp, video:03.mp4, 04.png
                    </div>
                    <input type="text" id="productMedia" placeholder="01.jpg, 02.webp, video:03.mp4, 04.png" required>
                </div>

                <!-- Translations -->
                <div class="translation-group">
                    <div class="translation-header">üá¨üáß –ê–Ω–≥–ª—ñ–π—Å—å–∫–∞ (English)</div>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞</label>
                        <input type="text" id="nameEn" placeholder="Braids with Curls" required>
                    </div>
                    <div class="form-group">
                        <label>–û–ø–∏—Å</label>
                        <textarea id="descEn" placeholder="A set of braids with added curls..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</label>
                        <div id="specsEnContainer" class="specs-container"></div>
                        <button type="button" class="btn-add-spec" onclick="addSpec('En')">+ –î–æ–¥–∞—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É</button>
                    </div>
                </div>

                <div class="translation-group">
                    <div class="translation-header">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</div>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞</label>
                        <input type="text" id="nameUk" placeholder="–ö–æ—Å–∏ –∑ –∫—É—á–µ—Ä—è–º–∏" required>
                    </div>
                    <div class="form-group">
                        <label>–û–ø–∏—Å</label>
                        <textarea id="descUk" placeholder="–ö–æ–º–ø–ª–µ–∫—Ç –∫–æ—Å–∏—á–æ–∫ –∑ –¥–æ–¥–∞–≤–∞–Ω–Ω—è–º –∫—É—á–µ—Ä—ñ–≤..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</label>
                        <div id="specsUkContainer" class="specs-container"></div>
                        <button type="button" class="btn-add-spec" onclick="addSpec('Uk')">+ –î–æ–¥–∞—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É</button>
                    </div>
                </div>

                <div class="translation-group">
                    <div class="translation-header">üá™üá∏ –Ü—Å–ø–∞–Ω—Å—å–∫–∞ (Espa√±ol)</div>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞</label>
                        <input type="text" id="nameEs" placeholder="Trenzas con rizos" required>
                    </div>
                    <div class="form-group">
                        <label>–û–ø–∏—Å</label>
                        <textarea id="descEs" placeholder="Conjunto de trenzas con rizos..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</label>
                        <div id="specsEsContainer" class="specs-container"></div>
                        <button type="button" class="btn-add-spec" onclick="addSpec('Es')">+ –î–æ–¥–∞—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É</button>
                    </div>
                </div>

                <!-- Rating -->
                <div class="form-row">
                    <div class="form-group">
                        <label>‚≠ê –†–µ–π—Ç–∏–Ω–≥ (–≤—ñ–¥ 1 –¥–æ 5)</label>
                        <input type="number" id="ratingValue" placeholder="4.8" step="0.1" min="1" max="5" required>
                    </div>

                    <div class="form-group">
                        <label>üí¨ –ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–¥–≥—É–∫—ñ–≤</label>
                        <input type="number" id="reviewCount" placeholder="127" required>
                    </div>
                </div>

                <button type="submit" class="btn-primary" id="submitBtn">‚úÖ –ó–±–µ—Ä–µ–≥—Ç–∏ –ü—Ä–æ–¥—É–∫—Ç</button>
                <button type="button" class="btn-secondary" id="cancelBtn" onclick="cancelEdit()" style="display: none; width: 100%;">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </form>
        </div>

        <!-- Instructions -->
        <div class="section">
            <h2 class="section-title">‚ÑπÔ∏è –í–∞–∂–ª–∏–≤–æ</h2>
            <div class="instructions">
                <p><strong>üì∏ –§–æ—Ä–º–∞—Ç–∏ –º–µ–¥—ñ–∞-—Ñ–∞–π–ª—ñ–≤:</strong></p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li><strong>–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è:</strong> .jpg, .jpeg, .png, .webp</li>
                    <li><strong>–í—ñ–¥–µ–æ:</strong> .mp4, .webm, .mov, .ogg</li>
                </ul>
                <p style="margin-top: 15px;"><strong>üìù –Ø–∫ –≤–∫–∞–∑—É–≤–∞—Ç–∏ –º–µ–¥—ñ–∞:</strong></p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è: <code>01.jpg, 02.webp, 03.png</code></li>
                    <li>–í—ñ–¥–µ–æ: <code>video:demo.mp4</code> (–∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º video:)</li>
                    <li>–ö–æ–º–±—ñ–Ω–æ–≤–∞–Ω–æ: <code>01.jpg, video:02.mp4, 03.webp</code></li>
                </ul>
                <p style="margin-top: 15px;"><strong>–í—Å—ñ —Ñ–∞–π–ª–∏ –º–∞—é—Ç—å –±—É—Ç–∏ –≤ –ø–∞–ø—Ü—ñ:</strong> <code>assets/products/[ID_–ø—Ä–æ–¥—É–∫—Ç—É]/</code></p>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script>
        let products = [];
        let editingIndex = -1;

        // Load products on page load
        window.addEventListener('DOMContentLoaded', loadProducts);

        async function loadProducts() {
            try {
                const response = await fetch('products.json');
                const data = await response.json();
                products = data.products || [];
                displayProducts();

                // Initialize specs with default values
                addSpec('En');
                addSpec('Uk');
                addSpec('Es');
            } catch (error) {
                showToast('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤: ' + error.message, 'error');
            }
        }

        function displayProducts() {
            const list = document.getElementById('productsList');
            if (products.length === 0) {
                list.innerHTML = '<p style="color: #999;">–ù–µ–º–∞—î –ø—Ä–æ–¥—É–∫—Ç—ñ–≤. –î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à–∏–π!</p>';
                return;
            }

            list.innerHTML = products.map((product, index) => `
                <div class="product-card">
                    <div class="product-info">
                        <div class="product-name">${product.translations.uk.name}</div>
                        <div class="product-price">${product.price} ‚Ç¨</div>
                        <small style="color: #666;">ID: ${product.id}</small>
                    </div>
                    <div class="product-actions">
                        <button class="btn-edit" onclick="editProduct(${index})">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                        <button class="btn-delete" onclick="deleteProduct(${index})">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
                    </div>
                </div>
            `).join('');
        }

        function addSpec(lang) {
            const container = document.getElementById(`specs${lang}Container`);
            const specDiv = document.createElement('div');
            specDiv.className = 'spec-input-group';
            specDiv.innerHTML = `
                <input type="text" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 55 —Å–º" class="spec-input-${lang}">
                <button type="button" class="btn-remove-spec" onclick="this.parentElement.remove()">‚úñ</button>
            `;
            container.appendChild(specDiv);
        }

        function getSpecs(lang) {
            const inputs = document.querySelectorAll(`.spec-input-${lang}`);
            return Array.from(inputs).map(input => input.value.trim()).filter(val => val !== '');
        }

        function setSpecs(lang, specs) {
            const container = document.getElementById(`specs${lang}Container`);
            container.innerHTML = '';
            specs.forEach(spec => {
                const specDiv = document.createElement('div');
                specDiv.className = 'spec-input-group';
                specDiv.innerHTML = `
                    <input type="text" value="${spec}" class="spec-input-${lang}">
                    <button type="button" class="btn-remove-spec" onclick="this.parentElement.remove()">‚úñ</button>
                `;
                container.appendChild(specDiv);
            });
        }

        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveProduct();
        });

        function saveProduct() {
            // Get form values
            const productId = document.getElementById('productId').value.trim();
            const price = parseFloat(document.getElementById('productPrice').value);
            const badge = document.getElementById('productBadge').value;
            const mediaNumbers = document.getElementById('productMedia').value.split(',').map(s => s.trim());

            // Get emojis
            const emojis = [
                document.getElementById('emoji1').value.trim(),
                document.getElementById('emoji2').value.trim(),
                document.getElementById('emoji3').value.trim(),
                document.getElementById('emoji4').value.trim()
            ];

            // Build media array with video and image support
            const media = mediaNumbers.map(item => {
                const trimmed = item.trim();

                // Check if it's a video
                if (trimmed.toLowerCase().startsWith('video:')) {
                    const videoFile = trimmed.substring(6); // Remove 'video:' prefix
                    return {
                        type: "video",
                        src: `./assets/products/${productId}/${videoFile}`
                    };
                }

                // It's an image - extract filename and extension
                const filename = trimmed;
                const lastDot = filename.lastIndexOf('.');
                const nameWithoutExt = lastDot > 0 ? filename.substring(0, lastDot) : filename;
                const extension = lastDot > 0 ? filename.substring(lastDot) : '.webp';

                // Build responsive image paths
                return {
                    type: "image",
                    src: `./assets/products/${productId}/optimized/${nameWithoutExt}-640w${extension}`,
                    srcset: `./assets/products/${productId}/optimized/${nameWithoutExt}-320w${extension} 320w, ./assets/products/${productId}/optimized/${nameWithoutExt}-640w${extension} 640w, ./assets/products/${productId}/optimized/${nameWithoutExt}-1024w${extension} 1024w`,
                    sizes: "(max-width: 320px) 320px, (max-width: 640px) 640px, 1024px"
                };
            });

            // Build product object
            const product = {
                id: productId,
                price: price,
                badge: badge,
                media: media,
                emojis: emojis,
                translations: {
                    en: {
                        name: document.getElementById('nameEn').value.trim(),
                        description: document.getElementById('descEn').value.trim(),
                        specs: getSpecs('En')
                    },
                    uk: {
                        name: document.getElementById('nameUk').value.trim(),
                        description: document.getElementById('descUk').value.trim(),
                        specs: getSpecs('Uk')
                    },
                    es: {
                        name: document.getElementById('nameEs').value.trim(),
                        description: document.getElementById('descEs').value.trim(),
                        specs: getSpecs('Es')
                    }
                },
                rating: {
                    value: document.getElementById('ratingValue').value,
                    reviewCount: document.getElementById('reviewCount').value
                }
            };

            // Add or update product
            if (editingIndex === -1) {
                products.push(product);
            } else {
                products[editingIndex] = product;
                editingIndex = -1;
            }

            // Save to file
            saveToFile();
        }

        async function saveToFile() {
            try {
                showToast('‚è≥ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è... –ó–∞—á–µ–∫–∞–π—Ç–µ, –±—É–¥—å –ª–∞—Å–∫–∞...', 'success');

                // Send to server
                const response = await fetch('http://localhost:3000/api/save-product', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ products: products })
                });

                const result = await response.json();

                if (result.success) {
                    showToast('‚úÖ ' + result.message, 'success');

                    // Reset form
                    document.getElementById('productForm').reset();
                    document.getElementById('formTitle').textContent = '‚ûï –î–æ–¥–∞—Ç–∏ –ù–æ–≤–∏–π –ü—Ä–æ–¥—É–∫—Ç';
                    document.getElementById('submitBtn').textContent = '‚úÖ –ó–±–µ—Ä–µ–≥—Ç–∏ –ü—Ä–æ–¥—É–∫—Ç';
                    document.getElementById('cancelBtn').style.display = 'none';

                    // Reset specs
                    ['En', 'Uk', 'Es'].forEach(lang => {
                        document.getElementById(`specs${lang}Container`).innerHTML = '';
                        addSpec(lang);
                    });

                    displayProducts();

                    // Open generated site in new tab after 2 seconds
                    setTimeout(() => {
                        window.open('index.html', '_blank');
                    }, 2000);
                } else {
                    showToast('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + result.message, 'error');
                }
            } catch (error) {
                showToast('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑\'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω–æ: node admin-server.js', 'error');
                console.error(error);
            }
        }

        function editProduct(index) {
            editingIndex = index;
            const product = products[index];

            // Fill form
            document.getElementById('productId').value = product.id;
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productBadge').value = product.badge;

            // Extract media files (videos and images)
            const mediaItems = product.media.map(m => {
                if (m.type === 'video') {
                    // Extract video filename
                    const videoMatch = m.src.match(/\/([^\/]+)$/);
                    return videoMatch ? `video:${videoMatch[1]}` : '';
                } else {
                    // Extract image filename with extension
                    const match = m.src.match(/\/([^\/]+)-640w(\.\w+)$/);
                    return match ? `${match[1]}${match[2]}` : '';
                }
            }).filter(item => item !== '').join(', ');
            document.getElementById('productMedia').value = mediaItems;

            // Fill emojis
            document.getElementById('emoji1').value = product.emojis[0] || '';
            document.getElementById('emoji2').value = product.emojis[1] || '';
            document.getElementById('emoji3').value = product.emojis[2] || '';
            document.getElementById('emoji4').value = product.emojis[3] || '';

            // Fill translations
            document.getElementById('nameEn').value = product.translations.en.name;
            document.getElementById('descEn').value = product.translations.en.description;
            setSpecs('En', product.translations.en.specs);

            document.getElementById('nameUk').value = product.translations.uk.name;
            document.getElementById('descUk').value = product.translations.uk.description;
            setSpecs('Uk', product.translations.uk.specs);

            document.getElementById('nameEs').value = product.translations.es.name;
            document.getElementById('descEs').value = product.translations.es.description;
            setSpecs('Es', product.translations.es.specs);

            // Fill rating
            document.getElementById('ratingValue').value = product.rating.value;
            document.getElementById('reviewCount').value = product.rating.reviewCount;

            // Update UI
            document.getElementById('formTitle').textContent = '‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ü—Ä–æ–¥—É–∫—Ç';
            document.getElementById('submitBtn').textContent = 'üíæ –û–Ω–æ–≤–∏—Ç–∏ –ü—Ä–æ–¥—É–∫—Ç';
            document.getElementById('cancelBtn').style.display = 'block';

            // Scroll to form
            document.getElementById('productForm').scrollIntoView({ behavior: 'smooth' });
        }

        function cancelEdit() {
            editingIndex = -1;
            document.getElementById('productForm').reset();
            document.getElementById('formTitle').textContent = '‚ûï –î–æ–¥–∞—Ç–∏ –ù–æ–≤–∏–π –ü—Ä–æ–¥—É–∫—Ç';
            document.getElementById('submitBtn').textContent = '‚úÖ –ó–±–µ—Ä–µ–≥—Ç–∏ –ü—Ä–æ–¥—É–∫—Ç';
            document.getElementById('cancelBtn').style.display = 'none';

            // Reset specs
            ['En', 'Uk', 'Es'].forEach(lang => {
                document.getElementById(`specs${lang}Container`).innerHTML = '';
                addSpec(lang);
            });
        }

        async function deleteProduct(index) {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –ø—Ä–æ–¥—É–∫—Ç?')) {
                products.splice(index, 1);
                displayProducts();
                await saveToFile();
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type;
            toast.style.display = 'block';

            setTimeout(() => {
                toast.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
